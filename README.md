# Тестовое задание

## Описание

Требуется организовать процессы интеграции CI/CD для автоматической сборки проекта из Git-репозитория. Среда выполнения - **Ubuntu 22.04**.

## Требования

### Автосборка проекта
- Автоматическая сборка из Gitea с помощью Jenkins при каждом push в основной репозиторий

### Автосборка PR (Pull Request)
1. При появлении PR он должен быть собран, но пока присутствует отметка **WIP** в заголовке, сборка должна быть пропущена
2. При каждом push в основной репозиторий PR должен быть пересобран (с той же проверкой на WIP)
3. При пропуске сборки из-за WIP-отметки в PR должно появиться уведомление о блокировке, а также запись в логе Jenkins

## Критерии готовности (DoD)
1. Docker-compose файл с разворачиванием всей необходимой инфраструктуры
2. Документация по доступу к сервисам и рабочим процессам

## Бонусные задания
1. Возможность принудительного запуска (вручную) PR с WIP
2. Настройка оповещений в Telegram, если PR с WIP висит более 3 дней

## Инфраструктура и доступ

### Запуск среды
```bash
./init.sh
```

### Доступ к сервисам
| Сервис  | URL                   | Учетные данные                           |
|---------|----------------------|------------------------------------------|
| Jenkins | http://localhost:8080 | Авторизация отключена, не требуется      |
| Gitea   | http://localhost:3000 | Требуется регистрация в веб-интерфейсе   |

### Тестовое приложение

Станичка "Hello Wolr"@ при успешном деплое - http://localhost:5000

### Настройка Gitea
1. Зарегистрируйтесь в веб-интерфейсе Gitea
2. Создайте репозиторий с названием `hello-world`
3. Создайте токен пользователя с правами `read` на область `repository/`

### Настройка Jenkins
В Jenkins необходимо создать:

1. Токен для Gitea в разделе Credentials
2. Опционально: учетные данные для Telegram (закомментировано в Jenkinsfile)
3. Pipeline с параметрами:
   - **Имя**: hello-world
   - **Тип**: pipeline
   - **Триггер**: Generic Webhook Trigger
   - **Definition**: Pipeline script from SCM
   - **SCM**: Git
   - **Repository URL**: http://localhost:3000
   - **Credentials**: созданные ранее
   - **Script path**: Jenkinsfile


### Создать новый репозиторий из командной строки

touch README.md
git init
git checkout -b main
git add README.md
git commit -m "first commit"
git remote add origin http://localhost:3000/admin/hello-world.git
git push -u origin main

##№ Отправка существующего репозитория из командной строки

git remote add origin http://localhost:3000/admin/hello-world.git
git push -u origin main


## Работа с WIP-метками в Pull Request

### Создание PR с WIP-меткой

```bash
# Создаем и переключаемся на новую ветку
git checkout -b feature

# Вносим изменения и коммитим с WIP-меткой
git add .
git commit -m "[WIP] Начата работа над новой функцией"

# Отправляем ветку в удаленный репозиторий
git push origin feature
```

После этого в веб-интерфейсе Gitea:
1. Создаем новый Pull Request из ветки feature
2. Заполняем заголовок и описание
3. Создаем PR (он будет содержать коммит с WIP-меткой)

### Удаление WIP-метки из коммита в PR

```bash
# Для последнего коммита
git commit --amend -m "Завершена работа над новой функцией"

# Или для конкретного коммита
git rebase -i abcd123^ # где abcd123 - хеш коммита с WIP-меткой

# Отправка изменений
git push -f origin feature
```

После обновления коммитов в PR Jenkins автоматически перезапустит сборку.

## Примечания

В реализации имеются некоторые ограничения:
- Образ jenkins:latest имеет проблемы с разрешением DNS. После нескольких часов попыток настройки был размещен в сети хоста, что не является лучшей практикой, но достаточно для этого задания
- В проекте используются plain text пароли в конфигурационных файлах для упрощения демонстрации
